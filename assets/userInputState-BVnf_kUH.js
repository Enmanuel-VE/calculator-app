const a=o=>o.replace(/\+\-/g,"-").replace(/\-\+/g,"-").replace(/--/g,"+").replace(/\+\+/g,"+").replace(/\(\+/g,"(").replace(/(\d+)%/g,"($1/100)").replace(/\)\(/g,")*(").replace(/(\d)(\()/g,"$1*(").replace(/(\))(\d)/g,")*$2"),u=o=>{const t=a(o),r=['"',";","`","<",">"];return/[a-zA-Z]/.test(t)||r.some(n=>t.includes(n))?{ok:!1,error:new Error("invalid format")}:{ok:!0,data:t}},l=o=>{const t=u(o);return t.ok?{ok:!0,data:t.data}:t};class i{#t;constructor(t){this.#t=structuredClone(t)}get(){return structuredClone(this.#t)}}class c{#t;#e;constructor(){this.#t=[],this.#e=-1}add(t){this.#e<this.#t.length-1&&(this.#t=this.#t.slice(0,this.#e+1)),this.#t.push(t),this.#e++}undo(){return this.#e>0?(this.#e--,this.#t[this.#e]):null}redo(){return this.#e<this.#t.length-1?(this.#e++,this.#t[this.#e]):null}currentMemento(){return this.#e===-1?null:this.#t[this.#e].get()}getForIndex(t){return t>=0&&t<=this.#t.length-1?this.#t[t]:null}getHistory(){return this.#t.map(t=>new i(t.get()))}}const h=new c,e={operation:()=>document.querySelector(".display__operation"),result:()=>document.querySelector(".display__result")};class d{#t;constructor(){this.#t=""}get(){return this.#t}set(t){this.#t=t}del(){this.set(this.get().slice(0,-1)),e.operation().value=this.get(),e.operation().scrollLeft=e.operation().scrollWidth}clear(){this.set(""),e.operation().value=this.get(),e.result().value=this.get()}push(t){this.set(this.get()+t),e.operation().value=this.get(),e.operation().scrollLeft=e.operation().scrollWidth}eval(){if(this.get().trim()===""){e.result().value="",e.operation().value="";return}const t=r=>{try{const s=new Function(`return ${r}`)();if(isNaN(s))throw new Error("Is not a number");return{ok:!0,data:s}}catch(s){return{ok:!1,error:s}}};try{const r=l(this.get());if(!r.ok)throw r.error;const s=t(r.data);if(!s.ok)throw s.error;const n=new i({operation:this.get(),result:s.data});return h.add(n),e.result().value=s.data,e.result().scrollLeft=0,s.data}catch(r){return console.error("Message:",r.message),console.error("Stack:",r.stack),e.result().value="Math error","Math error"}}}const p=new d;export{h as H,p as u};
