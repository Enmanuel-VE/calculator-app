const d=r=>r.replace(/\+\-/g,"-").replace(/\-\+/g,"-").replace(/--/g,"+").replace(/\+\+/g,"+").replace(/\(\+/g,"(").replace(/(\d+)%/g,"($1/100)").replace(/\)\(/g,")*(").replace(/(\d)(\()/g,"$1*(").replace(/(\))(\d)/g,")*$2"),g=r=>{const t=d(r),n=['"',";","`","<",">"];return/[a-zA-Z]/.test(t)||n.some(s=>t.includes(s))?{ok:!1,error:new Error("invalid format")}:{ok:!0,data:t}},f=r=>{const t=g(r);return t.ok?{ok:!0,data:t.data}:t};class l{#t;constructor(t){this.#t=structuredClone(t)}get(){return structuredClone(this.#t)}}class m{#t;#e;constructor(){this.#t=[],this.#e=-1}add(t){this.#e<this.#t.length-1&&(this.#t=this.#t.slice(0,this.#e+1)),this.#t.push(t),this.#e++}undo(){return this.#e>0?(this.#e--,this.#t[this.#e]):null}redo(){return this.#e<this.#t.length-1?(this.#e++,this.#t[this.#e]):null}currentMemento(){return this.#e===-1?null:this.#t[this.#e].get()}getForIndex(t){return t>=0&&t<=this.#t.length-1?this.#t[t]:null}getHistory(){return this.#t.map(t=>new l(t.get()))}}const u=new m,e={operation:()=>document.querySelector(".display__operation"),result:()=>document.querySelector(".display__result")};class v{#t;constructor(){this.#t=""}get(){return this.#t}set(t){this.#t=t}del(){this.set(this.get().slice(0,-1)),e.operation().value=this.get(),e.operation().scrollLeft=e.operation().scrollWidth}clear(){this.set(""),e.operation().value=this.get(),e.result().value=this.get()}push(t){this.set(this.get()+t),e.operation().value=this.get(),e.operation().scrollLeft=e.operation().scrollWidth}eval(){const t=u.currentMemento(),n=this.get()===t?.operation;if(this.get().trim()===""){e.result().value="",e.operation().value="";return}if(!n)try{const s=p=>{try{const i=new Function(`return ${p}`)();if(isNaN(i))throw new Error("Is not a number");return{ok:!0,data:i}}catch(i){return{ok:!1,error:i}}},a=f(this.get());if(!a.ok)throw a.error;const o=parseInt(s(a.data),10);if(!o.ok)throw o.error;const h=new l({operation:this.get(),result:o.data});return u.add(h),e.result().value=o.data,e.result().scrollLeft=0,o.data}catch(s){return console.error("Message:",s.message),console.error("Stack:",s.stack),e.result().value="Math error","Math error"}}}const I=new v;export{u as H,I as u};
