class a{#t;constructor(t){this.#t=structuredClone(t)}get(){return structuredClone(this.#t)}}class u{#t;#e;constructor(){this.#t=[],this.#e=-1}add(t){this.#e<this.#t.length-1&&(this.#t=this.#t.slice(0,this.#e+1)),this.#t.push(t),this.#e++}undo(){return this.#e>0?(this.#e--,this.#t[this.#e]):null}redo(){return this.#e<this.#t.length-1?(this.#e++,this.#t[this.#e]):null}changeCurrentMemento(t){return t>=0&&t<=this.#t.length-1?(this.#e=t,this.#t[t]):null}currentMemento(){return this.#e===-1?null:this.#t[this.#e].get()}getForIndex(t){return t>=0&&t<=this.#t.length-1?this.#t[t]:null}getHistory(){return this.#t.map(t=>new a(t.get()))}}const l=e=>e.replace(/\+\-/g,"-").replace(/\-\+/g,"-").replace(/--/g,"+").replace(/\+\+/g,"+").replace(/\(\+/g,"(").replace(/(\d+)%/g,"($1/100)").replace(/\)\(/g,")*(").replace(/(\d)(\()/g,"$1*(").replace(/(\))(\d)/g,")*$2"),c=e=>{const t=l(e),n=['"',";","`","<",">"];return/[a-zA-Z]/.test(t)||n.some(o=>t.includes(o))?{ok:!1,error:new Error("invalid format")}:{ok:!0,data:t}},h=e=>{const t=c(e);return t.ok?{ok:!0,data:t.data}:t};function p(e){try{const t=new Function(`return ${e}`)();if(isNaN(t))throw new Error("Is not a number");return{ok:!0,data:t}}catch(t){return{ok:!1,error:t}}}const r={get operation(){return document.querySelector(".display__operation")},get result(){return document.querySelector(".display__result")},get hasOperation(){return!!this.operation.value.trim()},get hasResult(){return!!this.result.value.trim()},setOperation(e){r.operation.value=e},setResult(e){r.result.value=e},clear(){this.setOperation(""),this.setResult("")}},i=new u;class d{#t;constructor(){this.#t=""}get(){return this.#t}set(t){this.#t=t}del(){this.set(this.get().slice(0,-1)),r.setOperation(this.get()),r.operation.scrollLeft=r.operation.scrollWidth}push(t){this.set(this.get()+t),r.setOperation(this.get()),r.operation.scrollLeft=r.operation.scrollWidth}clear(){this.set(""),r.clear()}eval(){const t=i.currentMemento(),n=this.get()===t?.operation;if(!r.hasOperation){r.clear();return}if(n){r.hasResult||r.setResult(t?.result);return}try{const s=h(this.get());if(!s.ok)throw s.error;const o=p(s.data);if(!o.ok)throw o.error;i.add(new a({operation:this.get(),result:o.data})),r.setResult(o.data),r.result.scrollLeft=0}catch(s){console.error("Message:",s.message),console.error("Stack:",s.stack),r.setResult("Math error")}}}const g=new d;export{i as H,g as u};
